# Schema definition for the custom Envio indexer.
#
# This file combines the automatically generated event entities with
# additional domain models for accounts, tokens, pools and prices.

############################
# Event Entities
############################

type CorkConfig_CorkPoolSet {
  id: ID!
  corkPool: String!
}

type CorkConfig_Paused {
  id: ID!
  account: String!
}

type CorkConfig_RoleAdminChanged {
  id: ID!
  role: String!
  previousAdminRole: String!
  newAdminRole: String!
}

type CorkConfig_RoleGranted {
  id: ID!
  role: String!
  account: String!
  sender: String!
}

type CorkConfig_RoleRevoked {
  id: ID!
  role: String!
  account: String!
  sender: String!
}

type CorkConfig_TreasurySet {
  id: ID!
  treasury: String!
}

type CorkConfig_Unpaused {
  id: ID!
  account: String!
}

type CorkPool_BaseRedemptionFeePercentageUpdated {
  id: ID!
  event_id: String!
  baseRedemptionFeePercentage: BigInt!
}

type CorkPool_Deposit {
  id: ID!
  marketId: String!
  sender: String!
  owner: String!
  assets: BigInt!
  shares: BigInt!
}

type CorkPool_DepositPaused {
  id: ID!
  marketId: String!
}

type CorkPool_DepositUnpaused {
  id: ID!
  marketId: String!
}

type CorkPool_Initialized {
  id: ID!
  version: BigInt!
}

type CorkPool_MarketCreated {
  id: ID!
  event_id: String!
  referenceAsset: String!
  collateralAsset: String!
  expiry: BigInt!
  exchangeRateProvider: String!
  principalToken: String!
  swapToken: String!
}

type CorkPool_OwnershipTransferred {
  id: ID!
  previousOwner: String!
  newOwner: String!
}



type CorkPool_ReturnPaused {
  id: ID!
  marketId: String!
}

type CorkPool_ReturnUnpaused {
  id: ID!
  marketId: String!
}

type CorkPool_Swap {
  id: ID!
  event_id: String!
  swaper: String!
  paUsed: BigInt!
  swapTokenUsed: BigInt!
  raReceived: BigInt!
  dsExchangeRate: BigInt!
  feePercentage: BigInt!
  fee: BigInt!
}

type CorkPool_SwapPaused {
  id: ID!
  marketId: String!
}

type CorkPool_SwapUnpaused {
  id: ID!
  marketId: String!
}

type CorkPool_UnwindSwap {
  id: ID!
  event_id: String!
  buyer: String!
  raUsed: BigInt!
  receivedReferenceAsset: BigInt!
  receivedSwapToken: BigInt!
  feePercentage: BigInt!
  fee: BigInt!
  exchangeRates: BigInt!
}

type CorkPool_UnwindSwapFeeRateUpdated {
  id: ID!
  event_id: String!
  unwindSwapFeeRate: BigInt!
}

type CorkPool_UnwindSwapPaused {
  id: ID!
  marketId: String!
}

type CorkPool_UnwindSwapUnpaused {
  id: ID!
  marketId: String!
}

type CorkPool_Upgraded {
  id: ID!
  implementation: String!
}



type CorkPool_WithdrawExtended {
  id: ID!
  marketId: String!
  sender: String!
  owner: String!
  assets0: BigInt!
  assets1: BigInt!
  shares0: BigInt!
  shares1: BigInt!
}

type CorkPool_WithdrawalPaused {
  id: ID!
  marketId: String!
}

type CorkPool_WithdrawalUnpaused {
  id: ID!
  marketId: String!
}

type ExchangeRateProvider_RateUpdated {
  id: ID!
  event_id: String!
  newRate: BigInt!
}

type SharesFactory_CorkPoolChanged {
  id: ID!
  oldCorkPool: String!
  newCorkPool: String!
}

type SharesFactory_Initialized {
  id: ID!
  version: BigInt!
}

type SharesFactory_OwnershipTransferred {
  id: ID!
  previousOwner: String!
  newOwner: String!
}

type SharesFactory_SharesDeployed {
  id: ID!
  collateralAsset: String!
  principalToken: String!
  swapToken: String!
}

type SharesFactory_Upgraded {
  id: ID!
  implementation: String!
}

type CorkPT_Transfer {
  id: ID!
  from: String!
  to: String!
  amount: BigInt!
}
type CorkST_Transfer {
  id: ID!
  from: String!
  to: String!
  amount: BigInt!
}
type CorkST_Approval {
  id: ID!
  owner: String!
  spender: String!
  amount: BigInt!
  srcAddress: String!
}
type CorkPT_Approval {
  id: ID!
  owner: String!
  spender: String!
  amount: BigInt!
  srcAddress: String!
}

type CorkPT_Withdraw {
  id: ID!
  caller: String!
  receiver: String!
  owner: String!
  assets: BigInt!
  shares: BigInt!
}

type CorkPT_Deposit {
  id: ID!
  caller: String!
  owner: String!
  assets: BigInt!
  shares: BigInt!
}


############################
# Domain Models
############################

enum TokenType {
  CPT
  CST
  CA
  REF
}

type Account {
  id: ID!
  address: String! @index
  transfersFrom: [TokenTransfer!]! @derivedFrom(field: "from")
  transfersTo: [TokenTransfer!]! @derivedFrom(field: "to")
  approvals: [TokenApproval!]! @derivedFrom(field: "owner")
  tokens: [AccountToken!]! @derivedFrom(field: "account")
  tokenEntries: [AccountTokenEntry!]! @derivedFrom(field: "account")
}

type AccountToken {
  id: ID!
  account: Account!
  token: Token!
  balance: BigInt! @index
}

type AccountTokenEntry {
  id: ID!
  account: Account!
  token: Token!
  amount: BigInt! @index
  timestamp: Timestamp! @index
  blockNumber: Int! @index
  transfer: TokenTransfer
}

type Token {
  id: ID!
  address: String! @index
  typ: TokenType! @index
  totalSupply: BigInt @index
  transfers: [TokenTransfer!]! @derivedFrom(field: "token")
  approvals: [TokenApproval!]! @derivedFrom(field: "token")
  accounts: [AccountToken!]! @derivedFrom(field: "token")
  accountEntries: [AccountTokenEntry!]! @derivedFrom(field: "token")
}

type TokenTransfer {
  id: ID!
  timestamp: Timestamp! @index
  blockNumber: Int! @index
  amount: BigInt! @index
  token: Token!
  from: Account!
  to: Account!
  entries: [AccountTokenEntry!]! @derivedFrom(field: "transfer")
}

type TokenApproval {
  id: ID!
  timestamp: Timestamp! @index
  blockNumber: Int! @index
  amount: BigInt!
  token: Token!
  owner: Account!
  spender: Account!
}

type Pool {
  id: ID!
  poolId: Bytes! @index
  principalTokenAddr: String! @index
  swapTokenAddr: String! @index
  collateralAssetAddr: String! @index
  referenceAssetAddr: String! @index
  exchangeRateProviderAddr: String! @index
  expiry: BigInt!
  startBlock: Int!
  assets: [PoolAsset!]! @derivedFrom(field: "pool")
  assetEntries: [PoolAssetEntry!]! @derivedFrom(field: "pool")
}

type PoolAsset {
  id: ID!
  pool: Pool!
  token: Token!
  balance: BigInt! @index
}

type PoolAssetEntry {
  id: ID!
  pool: Pool!
  token: Token! @index
  amount: BigInt! @index
  timestamp: Timestamp! @index
  blockNumber: Int! @index
}

type AssetPrice {
  id: ID!
  lastAnswer: BigInt!
  decimals: Int!
  updatedAt: Timestamp! @index
  toCurrency: String!
  fromToken: Token!
  toToken: Token!
}
